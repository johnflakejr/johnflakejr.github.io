<!DOCTYPE HTML> 
<head>
	<title>2018 picoCTF Buffer Overflow 3</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
<h1 class="jumbotron">2018 picoCTF Buffer Overflow 3 (in 2019)</h1>
<div class="container">
	<div class="row">
	<p>As part of a fun activity for my Army company, we took a CTF from last year and all tried our hands at it.  Due to obvious reasons, the honor code was necessary for the event to be a success. Below is a writeup for the challenge titled "Buffer Overflow 3".
	<br>
	<h2>Buffer Overflow 3</h2>
	<p>Prompt: It looks like Dr. Xernon added a stack canary to this program to protect against buffer overflows. Do you think you can bypass the protection and get the flag?</p>
	</div>
	<div class="row">
	<p>In this problem, we are handed a vulnerable binary, and the source for that binary.  The first relevant thing the binary does is perform a call to read_canary(), which reads in the canary value to be put in the stack:</p> 
	<pre>
void read_canary() {
	FILE *f = fopen("canary.txt","r");
  	if (f == NULL) {
    		printf("Canary is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.\n");
    		exit(0);
  	}

  	fread(global_canary,sizeof(char),CANARY_SIZE,f);
  	fclose(f);
}
	</pre>
	</div>
	<div class="row">
	<p>
	The second relevant thing the binary does is make a call to vuln(): 
	</p>
	<pre> 
void vuln(){
	char canary[CANARY_SIZE];
	char buf[BUFSIZE];
	char length[BUFSIZE];
	int count;
	int x = 0;
	memcpy(canary,global_canary,CANARY_SIZE);
	printf("How Many Bytes will You Write Into the Buffer?\n> ");
	while (x<BUFSIZE) {
		read(0,length+x,1);
		if (length[x]=='\n') break;
		x++;
	}
	sscanf(length,"%d",&count);

	printf("Input> ");
	read(0,buf,count);

	if (memcmp(canary,global_canary,CANARY_SIZE)) {
		printf("*** Stack Smashing Detected *** : Canary Value Corrupt!\n");
		exit(-1);
	}
	printf("Ok... Now Where's the Flag?\n");
	fflush(stdout);
}
	</pre> 
	</div>
	<div class="row">
	<p>
	With those two functions, our intended goal is to call the win() function, which reads the flag for us: 
	</p>
	<pre>
void win() {
	char buf[FLAGSIZE];
	FILE *f = fopen("flag.txt","r");
	if (f == NULL) {
		printf("Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.\n");
		exit(0);
	}

	fgets(buf,FLAGSIZE,f);
	puts(buf);
	fflush(stdout);
}
	</pre>
	</div>
<a href="http://johnflakejr.github.io/">Back to Homepage</a>
</div>
</body>
</html> 
